import{a as Q,c as X,g as Y,l as ee,m as te,n as ie,p as ne}from"./chunk-DDJUIS55.js";import{$a as A,Aa as f,Ab as J,Bb as V,Ca as v,Ia as p,Ka as r,La as a,Ma as U,Pa as R,Qa as w,Ra as d,Sa as H,V as C,W as h,Wa as s,Xa as u,Ya as N,Za as k,_a as B,bb as P,cb as L,db as Z,ea as y,na as j,pa as c,rb as z,sa as S,sb as W,ta as m,tb as K,vb as G,xa as q,za as E}from"./chunk-QWSCER6P.js";import{a as _,f as b}from"./chunk-PZ5UXJ7I.js";var M=class i{constructor(t,e){this.el=t;this.renderer=e}onMouseEnter(){this.renderer.setStyle(this.el.nativeElement,"transform","scale(1.5)"),this.renderer.setStyle(this.el.nativeElement,"transition","transform 0.3s")}onMouseLeave(){this.renderer.setStyle(this.el.nativeElement,"transform","scale(1)")}static \u0275fac=function(e){return new(e||i)(m(y),m(S))};static \u0275dir=E({type:i,selectors:[["","appDirectivaZoomFotos",""]],hostBindings:function(e,n){e&1&&w("mouseenter",function(){return n.onMouseEnter()})("mouseleave",function(){return n.onMouseLeave()})}})};var D=class i{constructor(t,e){this.el=t;this.renderer=e}rol;ngOnInit(){this.rol==="paciente"?this.renderer.setStyle(this.el.nativeElement,"background-color","#ADD8E6"):this.rol==="especialista"?this.renderer.setStyle(this.el.nativeElement,"background-color","#FFB6C1"):this.renderer.setStyle(this.el.nativeElement,"background-color","yellow")}static \u0275fac=function(e){return new(e||i)(m(y),m(S))};static \u0275dir=E({type:i,selectors:[["","appDirectivaColorRol",""]],inputs:{rol:[0,"appDirectivaColorRol","rol"]}})};var O=class i{transform(t){let e=t.toString().replace(/\D/g,""),n=e.length===8,o=n?e:e.padStart(7,"0");return n?o.replace(/(\d{2})(\d{3})(\d{3})/,"$1.$2.$3"):o.replace(/(\d{1})(\d{3})(\d{3})/,"$1.$2.$3")}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=f({name:"dni",type:i,pure:!0})};var I=class i{transform(t,e,n){return!t||!e||!n?t:t.filter(o=>o[n]?.toString().toLowerCase().includes(e.toLowerCase()))}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=f({name:"filtro",type:i,pure:!0})};var F=class i{transform(t){return t?t.slice().sort((e,n)=>{let o=e.apellido?.toLowerCase()||"",l=n.apellido?.toLowerCase()||"";return o.localeCompare(l)}):[]}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=f({name:"ordenar",type:i,pure:!0})};function re(i,t){i&1&&(r(0,"div",3),U(1,"div",4),r(2,"p"),s(3,"Cargando datos..."),a()())}function ae(i,t){if(i&1&&(r(0,"option",10),s(1),a()),i&2){let e=t.$implicit;p("value",e.clave),c(),N(" ",e.etiqueta," ")}}function se(i,t){if(i&1){let e=R();r(0,"div",5)(1,"label",6),s(2,"Buscar por:"),a(),r(3,"select",7),A("ngModelChange",function(o){C(e);let l=d();return B(l.campoSeleccionado,o)||(l.campoSeleccionado=o),h(o)}),v(4,ae,2,2,"option",8),a(),r(5,"input",9),A("ngModelChange",function(o){C(e);let l=d();return B(l.filtro,o)||(l.filtro=o),h(o)}),a()()}if(i&2){let e=d();c(3),k("ngModel",e.campoSeleccionado),c(),p("ngForOf",e.camposDisponibles),c(),k("ngModel",e.filtro)}}function ce(i,t){if(i&1&&U(0,"img",16),i&2){let e=d().$implicit;H("alt","Foto de ",e.nombre,""),p("src",e.imagen_perfil,j)}}function le(i,t){if(i&1){let e=R();r(0,"tr",13)(1,"td"),s(2),a(),r(3,"td"),s(4),a(),r(5,"td"),s(6),a(),r(7,"td"),s(8),P(9,"dni"),a(),r(10,"td"),s(11),a(),r(12,"td")(13,"button",14),w("click",function(){let o=C(e).$implicit,l=d(2);return h(l.habilitarUsuario(o))}),s(14),a()(),r(15,"td"),v(16,ce,1,3,"img",15),a()()}if(i&2){let e=t.$implicit,n=d(2);p("appDirectivaColorRol",n.obtenerTipoClase(e)),c(2),u(e.apellido),c(2),u(e.nombre),c(2),u(e.edad),c(2),u(L(9,9,e.dni)),c(3),u(e.mail),c(2),p("ngClass",e.aprobado?"btn-habilitado":"btn-deshabilitado"),c(),N(" ",e.aprobado?"Habilitado":"No habilitado"," "),c(2),p("ngIf",e.imagen_perfil)}}function pe(i,t){if(i&1&&(r(0,"div",11)(1,"table")(2,"thead")(3,"tr")(4,"th"),s(5,"Apellido"),a(),r(6,"th"),s(7,"Nombre"),a(),r(8,"th"),s(9,"Edad"),a(),r(10,"th"),s(11,"DNI"),a(),r(12,"th"),s(13,"Email"),a(),r(14,"th"),s(15,"Aprobado"),a(),r(16,"th"),s(17,"Foto de perfil"),a()()(),r(18,"tbody"),v(19,le,17,11,"tr",12),P(20,"filtro"),P(21,"ordenar"),a()()()),i&2){let e=d();c(19),p("ngForOf",L(21,5,Z(20,1,e.usuarios,e.filtro,e.campoSeleccionado)))}}var T=J(V.apiUrl,V.publicAnonKey),oe=class i{usuarios=[];cargando=!0;filtro="";campoSeleccionado="nombre";camposDisponibles=[{clave:"nombre",etiqueta:"Nombre"},{clave:"apellido",etiqueta:"Apellido"},{clave:"mail",etiqueta:"Mail"},{clave:"dni",etiqueta:"DNI"}];ngOnInit(){return b(this,null,function*(){this.usuarios=yield this.obtenerUsuarios(),this.cargando=!1})}obtenerUsuarios(){return b(this,null,function*(){let{data:t,error:e}=yield T.from("pacientes").select("*"),{data:n,error:o}=yield T.from("especialistas").select("*"),{data:l,error:$}=yield T.from("administradores").select("*");return e||o||$?(console.error("Error obteniendo datos:",e||o||$),[]):[...t.map(g=>_({},g)),...n.map(g=>_({},g)),...l.map(g=>_({},g))]})}obtenerTipoClase(t){return"obra_social"in t?"paciente":"especialidad"in t?"especialista":"es_admin"in t||t.rol==="admin"?"administrador":"Desconocido"}obtenerTablaPorTipo(t){return t.obra_social?"pacientes":t.especialidad?"especialistas":"administradores"}habilitarUsuario(t){return b(this,null,function*(){try{console.log(`\u2705 Cambiando estado de aprobaci\xF3n para ${t.mail}...`);let e=!t.aprobado,n=this.obtenerTablaPorTipo(t);console.log(n);let{error:o}=yield T.from(n).update({aprobado:e}).eq("id",t.id);if(o)throw o;console.log(`\u2705 Estado actualizado correctamente para ${t.mail}`),t.aprobado=e}catch(e){console.error("\u26A0 Error al actualizar estado de usuario:",e)}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=q({type:i,selectors:[["app-seccion-usuarios"]],decls:7,vars:3,consts:[["class","spinner-container",4,"ngIf"],["class","d-flex gap-2 mb-3 align-items-center",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"d-flex","gap-2","mb-3","align-items-center"],["for","campo"],["id","campo",1,"form-select","w-auto",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Escrib\xED para filtrar...",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],[1,"table-responsive"],[3,"appDirectivaColorRol",4,"ngFor","ngForOf"],[3,"appDirectivaColorRol"],[3,"click","ngClass"],["appDirectivaZoomFotos","","class","img-perfil",3,"src","alt",4,"ngIf"],["appDirectivaZoomFotos","",1,"img-perfil",3,"src","alt"]],template:function(e,n){e&1&&(r(0,"title"),s(1,"Secci\xF3n usuarios"),a(),r(2,"h1"),s(3,"Listado de usuarios"),a(),v(4,re,4,0,"div",0)(5,se,6,3,"div",1)(6,pe,22,7,"div",2)),e&2&&(c(4),p("ngIf",n.cargando),c(),p("ngIf",!n.cargando),c(),p("ngIf",!n.cargando))},dependencies:[ne,te,ie,Q,ee,X,Y,G,z,W,K,M,D,O,I,F],styles:[".table-responsive[_ngcontent-%COMP%]{overflow-x:auto;max-width:100%}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin:20px 0;font-size:16px;text-align:left;background:#fff;box-shadow:0 4px 8px #0000001a;border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #ddd}th[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;font-weight:700;text-transform:uppercase}tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}img[_ngcontent-%COMP%]{border-radius:50%;width:40px;height:40px;object-fit:cover}@media (max-width: 768px){th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px;padding:8px}}.btn-habilitado[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer}.btn-deshabilitado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer}button[_ngcontent-%COMP%]:hover{opacity:.8}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px;text-align:center}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px;width:100%;text-align:center;position:relative;flex-direction:column}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(0,0,0,.1);border-left-color:#007bff;width:40px;height:40px;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:10px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}p[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin:0}.table-responsive[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;position:relative}"]})};export{oe as SeccionUsuariosComponent};
