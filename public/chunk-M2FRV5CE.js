import{c as j}from"./chunk-CPBZMBZI.js";import{a as $,b as f,c as G,d as R,e as z,f as T,h as K,j as W,k as B,q as H}from"./chunk-DDJUIS55.js";import{Ab as D,Bb as P,Ca as d,Ia as s,J as O,Ka as a,La as l,Ma as p,Pa as C,Qa as g,Ra as u,Sa as L,V as b,W as h,Wa as m,Xa as F,Ya as M,na as y,pa as r,sb as V,ta as E,tb as q,vb as N,xa as U}from"./chunk-QWSCER6P.js";import{f as x}from"./chunk-PZ5UXJ7I.js";var w=class i{mail=null;setUsuario(t){this.mail=t,localStorage.setItem("mail",t)}getUsuario(){return this.mail||localStorage.getItem("mail")}logout(){this.mail=null,localStorage.removeItem("mail")}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=O({token:i,factory:i.\u0275fac,providedIn:"root"})};function Y(i,t){i&1&&(a(0,"small"),m(1,"\u26A0 Debes ingresar un email."),l())}function Z(i,t){i&1&&(a(0,"small"),m(1,"\u26A0 El formato del email es incorrecto."),l())}function ee(i,t){if(i&1&&(a(0,"div"),d(1,Y,2,0,"small",4)(2,Z,2,0,"small",4),l()),i&2){let e,n,o=u();r(),s("ngIf",(e=o.formularioLogin.get("mail"))==null||e.errors==null?null:e.errors.required),r(),s("ngIf",(n=o.formularioLogin.get("mail"))==null||n.errors==null?null:n.errors.email)}}function ie(i,t){i&1&&(a(0,"small"),m(1,"\u26A0 Debes ingresar una contrase\xF1a."),l())}function te(i,t){i&1&&(a(0,"small"),m(1,"\u26A0 La contrase\xF1a debe tener al menos 6 caracteres."),l())}function ne(i,t){if(i&1&&(a(0,"div"),d(1,ie,2,0,"small",4)(2,te,2,0,"small",4),l()),i&2){let e,n,o=u();r(),s("ngIf",(e=o.formularioLogin.get("password"))==null||e.errors==null?null:e.errors.required),r(),s("ngIf",(n=o.formularioLogin.get("password"))==null||n.errors==null?null:n.errors.minlength)}}function oe(i,t){i&1&&(a(0,"div",9),p(1,"div",10),a(2,"p"),m(3,"Cargando..."),l()())}function re(i,t){if(i&1){let e=C();a(0,"div")(1,"button",12),g("click",function(){let o=b(e).$implicit,c=u(2);return h(c.quickAccess(o))}),p(2,"img",13),m(3),l()()}if(i&2){let e=t.$implicit,n=t.index;r(2),L("alt","Foto de ",e.nombre,""),s("src",e.imagen_perfil,y),r(),M(" Acceso r\xE1pido a paciente ",n+1," ")}}function ae(i,t){if(i&1){let e=C();a(0,"div")(1,"button",12),g("click",function(){let o=b(e).$implicit,c=u(2);return h(c.quickAccess(o))}),p(2,"img",13),m(3),l()()}if(i&2){let e=t.$implicit,n=t.index;r(2),L("alt","Foto de ",e.nombre,""),s("src",e.imagen_perfil,y),r(),M(" Acceso r\xE1pido a especialista ",n+1," ")}}function se(i,t){if(i&1){let e=C();a(0,"div")(1,"button",14),g("click",function(){b(e);let o=u(2);return h(o.quickAccess(o.administrador))}),p(2,"img",13),m(3," Acceso r\xE1pido administrador "),l()()}if(i&2){let e=u(2);r(2),L("alt","Foto de ",e.administrador.nombre,""),s("src",e.administrador.imagen_perfil,y)}}function le(i,t){if(i&1&&(a(0,"div"),d(1,re,4,4,"div",11)(2,ae,4,4,"div",11)(3,se,4,3,"div",4),l()),i&2){let e=u();r(),s("ngForOf",e.pacientes),r(),s("ngForOf",e.especialistas),r(),s("ngIf",e.administrador)}}function me(i,t){i&1&&(a(0,"div",9),p(1,"div",10),a(2,"p"),m(3,"Iniciando sesion..."),l()())}var _=D(P.apiUrl,P.publicAnonKey),J=class i{constructor(t,e){this.router=t;this.authService=e}mail="";password="";errorMessage="";message="";messageType="";formularioLogin;isLoading=!1;pacientes=[];especialistas=[];administrador;isLoadingUsuarios=!1;ngOnInit(){this.formularioLogin=new z({mail:new T("",[f.required,f.email]),password:new T("",[f.required,f.minLength(6)])}),this.cargarUsuarios()}login(){return x(this,null,function*(){this.errorMessage="",this.isLoading=!0;try{let t=this.formularioLogin.get("mail")?.value,e=this.formularioLogin.get("password")?.value,{data:n,error:o}=yield _.auth.signInWithPassword({email:t,password:e});if(o||!n?.user){this.errorMessage="\u26A0 Email o contrase\xF1a incorrectos.";return}let c=n.user.id,ce=n.user.email_confirmed_at,v,I="",{data:k}=yield _.from("administradores").select("id").eq("id",c).maybeSingle();k&&(v=k,I="admin");let{data:A}=yield _.from("pacientes").select("id").eq("id",c).maybeSingle();A&&(v=A,I="paciente");let{data:S}=yield _.from("especialistas").select("id, aprobado").eq("id",c).maybeSingle();if(S&&(v=S,I="especialista",!S.aprobado)){this.errorMessage="\u26A0 Tu cuenta debe ser aprobada por un administrador.";return}if(!v){this.errorMessage="\u26A0 Usuario no encontrado.";return}this.router.navigate(["/home"])}catch{this.errorMessage="\u26A0 Error al iniciar sesi\xF3n."}finally{this.isLoading=!1}})}obtenerUsuarios(t,e){return x(this,null,function*(){let{data:n,error:o}=yield _.from(t).select("*").limit(e);return o?(console.error(`Error obteniendo usuarios de ${t}:`,o),[]):n})}cargarUsuarios(){return x(this,null,function*(){this.isLoadingUsuarios=!0,this.pacientes=yield this.obtenerUsuarios("pacientes",3),this.especialistas=yield this.obtenerUsuarios("especialistas",2),this.administrador=(yield this.obtenerUsuarios("administradores",1))[0],console.log("Pacientes:",this.pacientes),console.log("Especialistas:",this.especialistas),console.log("Administrador:",this.administrador),this.isLoadingUsuarios=!1})}quickAccess(t){this.formularioLogin.patchValue({mail:t.mail,password:t.contrasena}),console.log(`Acceso r\xE1pido a: ${t.nombre} ${t.apellido}`)}static \u0275fac=function(e){return new(e||i)(E(j),E(w))};static \u0275cmp=U({type:i,selectors:[["app-login"]],decls:18,vars:8,consts:[[1,"contenedor-login"],[1,"formulario-login"],[3,"ngSubmit","formGroup"],["type","text","formControlName","mail","placeholder","Email"],[4,"ngIf"],["type","password","formControlName","password","placeholder","Password"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","overlay",4,"ngIf"],[1,"error-msg"],[1,"overlay"],[1,"spinner"],[4,"ngFor","ngForOf"],[1,"btn","btn-outline-primary","quick-btn",3,"click"],[1,"profile-img",3,"src","alt"],[1,"btn","btn-outline-primary",3,"click"]],template:function(e,n){if(e&1&&(a(0,"title"),m(1,"Login"),l(),a(2,"h1"),m(3,"Inicia sesi\xF3n"),l(),a(4,"div",0)(5,"div",1)(6,"form",2),g("ngSubmit",function(){return n.login()}),p(7,"input",3),d(8,ee,3,2,"div",4),p(9,"input",5),d(10,ne,3,2,"div",4),a(11,"button",6),m(12,"Iniciar sesi\xF3n"),l(),d(13,oe,4,0,"div",7)(14,le,4,3,"div",4),l(),a(15,"div",8),m(16),l()()(),d(17,me,4,0,"div",7)),e&2){let o,c;r(6),s("formGroup",n.formularioLogin),r(2),s("ngIf",((o=n.formularioLogin.get("mail"))==null?null:o.invalid)&&((o=n.formularioLogin.get("mail"))==null?null:o.touched)),r(2),s("ngIf",((c=n.formularioLogin.get("password"))==null?null:c.invalid)&&((c=n.formularioLogin.get("password"))==null?null:c.touched)),r(),s("disabled",n.formularioLogin.invalid||n.isLoading),r(2),s("ngIf",n.isLoadingUsuarios),r(),s("ngIf",!n.isLoadingUsuarios),r(2),F(n.errorMessage),r(),s("ngIf",n.isLoading)}},dependencies:[N,V,q,H,K,$,G,R,W,B],styles:["body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;font-family:Poppins,sans-serif;background-color:#f4f4f4}.contenedor-login[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.formulario-login[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0003;width:100%;max-width:400px}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:5px}.btn-outline-primary[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:10px;border-radius:5px}.btn-success[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:10px;border:none;border-radius:5px;cursor:pointer;background:#28a745;color:#fff}.btn-link[_ngcontent-%COMP%]{background:none;color:#007bff;cursor:pointer}.error-msg[_ngcontent-%COMP%]{color:red;margin-top:10px;display:flex;justify-content:center;text-align:center}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;justify-content:center;align-items:center;z-index:9999;pointer-events:none}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #28a745;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:10px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;font-size:18px;font-weight:700}.profile-img[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%;object-fit:cover}"]})};export{J as LoginComponent};
