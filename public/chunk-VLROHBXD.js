import{a as P,b as g,c as q,d as T,e as O,f as x,g as D,i as F,j as N,n as j,o as G}from"./chunk-CV4BKI4J.js";import{$ as V,A as o,B as a,C as u,D as h,E as v,G as d,H as b,I as s,J as E,R as I,S as M,V as k,Z as A,_ as C,p as l,r as _,s as S,w as c,y as m}from"./chunk-HDPR4ZAD.js";import{f as w}from"./chunk-PZ5UXJ7I.js";function U(i,t){i&1&&(o(0,"small"),s(1,"\u26A0 Debes ingresar un email."),a())}function B(i,t){i&1&&(o(0,"small"),s(1,"\u26A0 El formato del email es incorrecto."),a())}function K(i,t){if(i&1&&(o(0,"div"),c(1,U,2,0,"small",4)(2,B,2,0,"small",4),a()),i&2){let r,e,n=b();l(),m("ngIf",(r=n.formularioLogin.get("mail"))==null||r.errors==null?null:r.errors.required),l(),m("ngIf",(e=n.formularioLogin.get("mail"))==null||e.errors==null?null:e.errors.email)}}function W(i,t){i&1&&(o(0,"small"),s(1,"\u26A0 Debes ingresar una contrase\xF1a."),a())}function H(i,t){i&1&&(o(0,"small"),s(1,"\u26A0 La contrase\xF1a debe tener al menos 6 caracteres."),a())}function J(i,t){if(i&1&&(o(0,"div"),c(1,W,2,0,"small",4)(2,H,2,0,"small",4),a()),i&2){let r,e,n=b();l(),m("ngIf",(r=n.formularioLogin.get("password"))==null||r.errors==null?null:r.errors.required),l(),m("ngIf",(e=n.formularioLogin.get("password"))==null||e.errors==null?null:e.errors.minlength)}}function Q(i,t){i&1&&(h(0),s(1,"Iniciar sesi\xF3n"),v())}function X(i,t){i&1&&(h(0),u(1,"div",10),s(2," Iniciando... "),v())}function Y(i,t){i&1&&(o(0,"div",11),u(1,"div",12),o(2,"p"),s(3,"Procesando..."),a()())}var f=A(C.apiUrl,C.publicAnonKey),R=class i{constructor(t,r){this.router=t;this.authService=r}mail="";password="";errorMessage="";message="";messageType="";formularioLogin;isLoading=!1;ngOnInit(){this.formularioLogin=new O({mail:new x("",[g.required,g.email]),password:new x("",[g.required,g.minLength(6)])})}login(){return w(this,null,function*(){this.isLoading=!0,this.message="";try{let t=this.formularioLogin.get("mail")?.value,r=this.formularioLogin.get("password")?.value,{data:e}=yield f.from("pacientes").select("*").eq("mail",t).single(),{data:n}=yield f.from("especialistas").select("*").eq("mail",t).single(),{data:p}=yield f.from("administradores").select("*").eq("mail",t).single();if(!e&&!n&&!p){this.errorMessage="\u26A0 El usuario no est\xE1 registrado.";return}let{data:L,error:y}=yield f.auth.getUser();if(y||!L?.user||!L.user.email_confirmed_at){console.log(y),this.errorMessage="\u26A0 Debes confirmar tu correo antes de iniciar sesi\xF3n.";return}let{error:z}=yield f.auth.signInWithPassword({email:t,password:r});if(z){this.errorMessage="\u26A0 Usuario o contrase\xF1a incorrectos.";return}this.message="\u2705 Inicio de sesi\xF3n exitoso. Bienvenido!",this.authService.setUsuario(this.mail),this.messageType="success",this.router.navigate(["/home"])}catch{this.errorMessage="\u26A0 Error inesperado al iniciar sesi\xF3n."}finally{this.isLoading=!1}})}quickAccessPaciente(){this.formularioLogin.patchValue({mail:"ezequielmartinb10@gmail.com",password:"123456"})}quickAccessEspecialista(){this.formularioLogin.patchValue({mail:"ezequielmartinb10@gmail.com",password:"123456"})}quickAccessAdmin(){this.formularioLogin.patchValue({mail:"ezequielmartinb10@gmail.com",password:"123456"})}static \u0275fac=function(r){return new(r||i)(_(k),_(V))};static \u0275cmp=S({type:i,selectors:[["app-login"]],decls:21,vars:8,consts:[[1,"contenedor-login"],[1,"formulario-login"],[3,"ngSubmit","formGroup"],["type","text","formControlName","mail","placeholder","Email"],[4,"ngIf"],["type","password","formControlName","password","placeholder","Password"],["type","submit",1,"btn","btn-success",3,"disabled"],["type","button",1,"btn","btn-link",3,"click"],[1,"error-msg"],["class","overlay",4,"ngIf"],[1,"spinner-btn"],[1,"overlay"],[1,"spinner"]],template:function(r,e){if(r&1&&(o(0,"h1"),s(1,"Inicia sesi\xF3n"),a(),o(2,"div",0)(3,"div",1)(4,"form",2),d("ngSubmit",function(){return e.login()}),u(5,"input",3),c(6,K,3,2,"div",4),u(7,"input",5),c(8,J,3,2,"div",4),o(9,"button",6),c(10,Q,2,0,"ng-container",4)(11,X,3,0,"ng-container",4),a(),o(12,"button",7),d("click",function(){return e.quickAccessPaciente()}),s(13,"Acceso r\xE1pido paciente"),a(),o(14,"button",7),d("click",function(){return e.quickAccessEspecialista()}),s(15,"Acceso r\xE1pido especialista"),a(),o(16,"button",7),d("click",function(){return e.quickAccessAdmin()}),s(17,"Acceso r\xE1pido admin"),a()(),o(18,"div",8),s(19),a()()(),c(20,Y,4,0,"div",9)),r&2){let n,p;l(4),m("formGroup",e.formularioLogin),l(2),m("ngIf",((n=e.formularioLogin.get("mail"))==null?null:n.invalid)&&((n=e.formularioLogin.get("mail"))==null?null:n.touched)),l(2),m("ngIf",((p=e.formularioLogin.get("password"))==null?null:p.invalid)&&((p=e.formularioLogin.get("password"))==null?null:p.touched)),l(),m("disabled",e.formularioLogin.invalid||e.isLoading),l(),m("ngIf",!e.isLoading),l(),m("ngIf",e.isLoading),l(8),E(e.errorMessage),l(),m("ngIf",e.isLoading)}},dependencies:[M,I,j,D,P,q,T,G,F,N],styles:["body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;font-family:Poppins,sans-serif;background-color:#f4f4f4}.contenedor-login[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.formulario-login[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0003;width:100%;max-width:400px}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:5px}button[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:10px;border:none;border-radius:5px;cursor:pointer}.btn-success[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-link[_ngcontent-%COMP%]{background:none;color:#007bff;cursor:pointer}.error-msg[_ngcontent-%COMP%]{color:red;margin-top:10px;display:flex;justify-content:center;text-align:center}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;justify-content:center;align-items:center;z-index:9999;pointer-events:none}.spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #28a745;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{R as LoginComponent};
