import{a as T,b as g,c as O,d as D,e as F,f as S,g as N,i as j,j as G,n as V,o as R}from"./chunk-CV4BKI4J.js";import{$ as z,A as o,B as a,C as u,D as C,E as x,G as d,H as L,I as l,J as M,R as k,S as A,V as P,Z as q,_ as y,p as s,r as b,s as E,w as c,y as m}from"./chunk-HDPR4ZAD.js";import{f as I}from"./chunk-PZ5UXJ7I.js";function K(i,n){i&1&&(o(0,"small"),l(1,"\u26A0 Debes ingresar un email."),a())}function W(i,n){i&1&&(o(0,"small"),l(1,"\u26A0 El formato del email es incorrecto."),a())}function H(i,n){if(i&1&&(o(0,"div"),c(1,K,2,0,"small",4)(2,W,2,0,"small",4),a()),i&2){let t,e,r=L();s(),m("ngIf",(t=r.formularioLogin.get("mail"))==null||t.errors==null?null:t.errors.required),s(),m("ngIf",(e=r.formularioLogin.get("mail"))==null||e.errors==null?null:e.errors.email)}}function J(i,n){i&1&&(o(0,"small"),l(1,"\u26A0 Debes ingresar una contrase\xF1a."),a())}function Q(i,n){i&1&&(o(0,"small"),l(1,"\u26A0 La contrase\xF1a debe tener al menos 6 caracteres."),a())}function X(i,n){if(i&1&&(o(0,"div"),c(1,J,2,0,"small",4)(2,Q,2,0,"small",4),a()),i&2){let t,e,r=L();s(),m("ngIf",(t=r.formularioLogin.get("password"))==null||t.errors==null?null:t.errors.required),s(),m("ngIf",(e=r.formularioLogin.get("password"))==null||e.errors==null?null:e.errors.minlength)}}function Y(i,n){i&1&&(C(0),l(1,"Iniciar sesi\xF3n"),x())}function Z(i,n){i&1&&(C(0),u(1,"div",10),l(2," Iniciando... "),x())}function $(i,n){i&1&&(o(0,"div",11),u(1,"div",12),o(2,"p"),l(3,"Procesando..."),a()())}var f=q(y.apiUrl,y.publicAnonKey),U=class i{constructor(n,t){this.router=n;this.authService=t}mail="";password="";errorMessage="";message="";messageType="";formularioLogin;isLoading=!1;ngOnInit(){this.formularioLogin=new F({mail:new S("",[g.required,g.email]),password:new S("",[g.required,g.minLength(6)])})}login(){return I(this,null,function*(){let n=null,t="";this.isLoading=!0,this.message="";try{let e=this.formularioLogin.get("mail")?.value,r=this.formularioLogin.get("password")?.value,{data:p,error:B}=yield f.auth.signInWithPassword({email:e,password:r});if(B){this.errorMessage="\u26A0 Usuario o contrase\xF1a incorrectos.";return}let{data:w}=yield f.auth.getSession();if(!w.session){this.errorMessage="\u26A0 No hay una sesi\xF3n activa.";return}if(!w.session.user?.email_confirmed_at){this.errorMessage="\u26A0 Debes confirmar tu correo antes de iniciar sesi\xF3n.";return}let{data:_}=yield f.from("pacientes").select("*").filter("mail","eq",e).single();_&&(n=_,t="paciente");let{data:v}=yield f.from("especialistas").select("*").filter("mail","eq",e).single();v&&(n=v,t="especialista");let{data:h}=yield f.from("administradores").select("*").filter("mail","eq",e).single();if(h&&(n=h,t="administrador"),localStorage.setItem("nombre",n.nombre),localStorage.setItem("apellido",n.apellido),localStorage.setItem("rol",t),localStorage.setItem("mail",e),!_&&!v&&!h){this.errorMessage="\u26A0 El usuario no est\xE1 registrado.";return}this.message="\u2705 Inicio de sesi\xF3n exitoso. Bienvenido!",this.authService.setUsuario(e),this.messageType="success",this.router.navigate(["/home"])}catch{this.errorMessage="\u26A0 Error inesperado al iniciar sesi\xF3n."}finally{this.isLoading=!1}})}quickAccessPaciente(){this.formularioLogin.patchValue({mail:"ezequielmartinb10@gmail.com",password:"123456"})}quickAccessEspecialista(){this.formularioLogin.patchValue({mail:"ezequielmartinb10@gmail.com",password:"123456"})}quickAccessAdmin(){this.formularioLogin.patchValue({mail:"ezequielmartinb10@gmail.com",password:"123456"})}static \u0275fac=function(t){return new(t||i)(b(P),b(z))};static \u0275cmp=E({type:i,selectors:[["app-login"]],decls:23,vars:8,consts:[[1,"contenedor-login"],[1,"formulario-login"],[3,"ngSubmit","formGroup"],["type","text","formControlName","mail","placeholder","Email"],[4,"ngIf"],["type","password","formControlName","password","placeholder","Password"],["type","submit",1,"btn","btn-success",3,"disabled"],["type","button",1,"btn","btn-link",3,"click"],[1,"error-msg"],["class","overlay",4,"ngIf"],[1,"spinner-btn"],[1,"overlay"],[1,"spinner"]],template:function(t,e){if(t&1&&(o(0,"title"),l(1,"Login"),a(),o(2,"h1"),l(3,"Inicia sesi\xF3n"),a(),o(4,"div",0)(5,"div",1)(6,"form",2),d("ngSubmit",function(){return e.login()}),u(7,"input",3),c(8,H,3,2,"div",4),u(9,"input",5),c(10,X,3,2,"div",4),o(11,"button",6),c(12,Y,2,0,"ng-container",4)(13,Z,3,0,"ng-container",4),a(),o(14,"button",7),d("click",function(){return e.quickAccessPaciente()}),l(15,"Acceso r\xE1pido paciente"),a(),o(16,"button",7),d("click",function(){return e.quickAccessEspecialista()}),l(17,"Acceso r\xE1pido especialista"),a(),o(18,"button",7),d("click",function(){return e.quickAccessAdmin()}),l(19,"Acceso r\xE1pido admin"),a()(),o(20,"div",8),l(21),a()()(),c(22,$,4,0,"div",9)),t&2){let r,p;s(6),m("formGroup",e.formularioLogin),s(2),m("ngIf",((r=e.formularioLogin.get("mail"))==null?null:r.invalid)&&((r=e.formularioLogin.get("mail"))==null?null:r.touched)),s(2),m("ngIf",((p=e.formularioLogin.get("password"))==null?null:p.invalid)&&((p=e.formularioLogin.get("password"))==null?null:p.touched)),s(),m("disabled",e.formularioLogin.invalid||e.isLoading),s(),m("ngIf",!e.isLoading),s(),m("ngIf",e.isLoading),s(8),M(e.errorMessage),s(),m("ngIf",e.isLoading)}},dependencies:[A,k,V,N,T,O,D,R,j,G],styles:["body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;font-family:Poppins,sans-serif;background-color:#f4f4f4}.contenedor-login[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.formulario-login[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0003;width:100%;max-width:400px}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:5px}button[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:10px;border:none;border-radius:5px;cursor:pointer}.btn-success[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-link[_ngcontent-%COMP%]{background:none;color:#007bff;cursor:pointer}.error-msg[_ngcontent-%COMP%]{color:red;margin-top:10px;display:flex;justify-content:center;text-align:center}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;justify-content:center;align-items:center;z-index:9999;pointer-events:none}.spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #28a745;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{U as LoginComponent};
