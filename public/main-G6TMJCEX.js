import{a as N,b as P,c as h,d as R,e as j,f as F,g as V}from"./chunk-IFSQKUUN.js";import{Ab as C,Bb as m,Ca as A,Ia as g,Ka as a,La as r,Ma as U,P as O,Pa as _,Qa as x,Ra as w,V as v,W as y,Wa as s,fb as H,gb as I,pa as u,ta as d,tb as S,vb as D,xa as f}from"./chunk-QWSCER6P.js";import{f as c}from"./chunk-PZ5UXJ7I.js";function J(t,n){t&1&&(a(0,"button",4),s(1,"Login"),r())}function Q(t,n){t&1&&(a(0,"button",5),s(1,"Registro"),r())}function W(t,n){if(t&1){let e=_();a(0,"button",6),x("click",function(){v(e);let i=w();return y(i.irASeccionUsuarios())}),s(1,"Secci\xF3n Usuarios"),r()}}var T=C(m.apiUrl,m.publicAnonKey),E=class t{constructor(n,e){this.cd=n;this.router=e}isAdmin=!1;usuarioAutenticado=!1;cargandoBotones=!0;ngOnInit(){return c(this,null,function*(){yield this.verificarAdmin();let{data:n}=yield T.auth.getSession();this.usuarioAutenticado=!!n.session?.user,this.cargandoBotones=!1})}verificarAdmin(){return c(this,null,function*(){let{data:n}=yield T.auth.getSession();console.log("Sesi\xF3n:",n);let e=n.session?.user;if(!e){this.isAdmin=!1,this.cd.detectChanges();return}let{data:o,error:i}=yield T.from("administradores").select("id").eq("id",e.id).maybeSingle();console.log("AdminData:",o,"Error:",i),this.isAdmin=!!o,this.cd.detectChanges()})}irASeccionUsuarios(){this.isAdmin&&this.router.navigate(["/admin/usuarios"])}static \u0275fac=function(e){return new(e||t)(d(I),d(h))};static \u0275cmp=f({type:t,selectors:[["app-home"]],decls:8,vars:3,consts:[[1,"contenedor-botones"],["class","btn btn-outline-primary","routerLink","/login",4,"ngIf"],["class","btn btn-outline-primary","routerLink","/registro",4,"ngIf"],["class","btn btn-outline-primary",3,"click",4,"ngIf"],["routerLink","/login",1,"btn","btn-outline-primary"],["routerLink","/registro",1,"btn","btn-outline-primary"],[1,"btn","btn-outline-primary",3,"click"]],template:function(e,o){e&1&&(a(0,"title"),s(1,"Home"),r(),a(2,"h1"),s(3,"Bienvenidos a la Cl\xEDnica Online"),r(),a(4,"div",0),A(5,J,2,0,"button",1)(6,Q,2,0,"button",2)(7,W,2,0,"button",3),r()),e&2&&(u(5),g("ngIf",!o.usuarioAutenticado),u(),g("ngIf",!o.usuarioAutenticado),u(),g("ngIf",o.isAdmin))},dependencies:[D,S,R],styles:["h1[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-weight:600;color:#0d6efd;text-align:center;margin-top:20px}body[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}.contenedor-botones[_ngcontent-%COMP%]{text-align:center}"]})};var k=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=f({type:t,selectors:[["app-error"]],decls:2,vars:0,template:function(e,o){e&1&&(a(0,"h1"),s(1,"404 p\xE1gina no encontrada"),r())},encapsulation:2})};var X=C(m.apiUrl,m.publicAnonKey),K=(t,n)=>c(null,null,function*(){let e=O(V),o=O(h),i=e.getUsuario();console.log("El usuario logueado desde el guard es: "+i);try{console.log(`\u2705 Verificando si ${i} es administrador...`);let{data:l,error:b}=yield X.from("administradores").select("id").eq("mail",i).single();return b||!l?(console.warn(`\u26A0 Acceso denegado. ${i} no est\xE1 en la tabla de administradores.`),o.navigate(["/login"]),!1):(console.log(`\u2705 Acceso permitido. ${i} es administrador.`),!0)}catch(l){return console.error("\u26A0 Error al verificar permisos de administrador:",l),o.navigate(["/login"]),!1}});var $=[{path:"",pathMatch:"full",redirectTo:"home"},{path:"home",component:E},{path:"login",loadComponent:()=>import("./chunk-VCYHKRHI.js").then(t=>t.LoginComponent)},{path:"registro",loadComponent:()=>import("./chunk-6YHLOBXN.js").then(t=>t.RegistroComponent)},{path:"admin/usuarios",loadComponent:()=>import("./chunk-C476XQM3.js").then(t=>t.SeccionUsuariosComponent),canActivate:[K]},{path:"**",component:k}];var G={providers:[H({eventCoalescing:!0}),F($)]};function Y(t,n){if(t&1){let e=_();a(0,"button",3),x("click",function(){v(e);let i=w();return y(i.logout())}),s(1,"Cerrar Sesi\xF3n"),r()}}var p=C(m.apiUrl,m.publicAnonKey),L=class t{constructor(n,e){this.cd=n;this.router=e}isLoggedIn=!1;errorMessage="";ngOnInit(){return c(this,null,function*(){yield this.checkSession(),p.auth.onAuthStateChange((n,e)=>c(this,null,function*(){e?.user?yield this.checkSession():(this.isLoggedIn=!1,this.cd.detectChanges())}))})}checkSession(){return c(this,null,function*(){let{data:n}=yield p.auth.getSession(),e=n.session?.user;if(!e){this.isLoggedIn=!1,this.cd.detectChanges();return}let o="",i,{data:l}=yield p.from("administradores").select("id").eq("id",e.id).maybeSingle();l&&(i=l,o="admin");let{data:b}=yield p.from("pacientes").select("id").eq("id",e.id).maybeSingle();b&&(i=b,o="paciente");let{data:M}=yield p.from("especialistas").select("id, aprobado").eq("id",e.id).maybeSingle();if(M&&(i=M,o="especialista",!M.aprobado)){console.warn("\u26A0 Este especialista a\xFAn no ha sido aprobado."),yield p.auth.signOut(),this.isLoggedIn=!1,this.router.navigate(["/login"]),this.cd.detectChanges();return}if(!i){console.warn("\u26A0 Usuario no encontrado en ninguna tabla."),yield p.auth.signOut(),this.isLoggedIn=!1,this.router.navigate(["/login"]),this.cd.detectChanges();return}this.isLoggedIn=!0,this.cd.detectChanges()})}logout(){return c(this,null,function*(){try{let{data:n,error:e}=yield p.auth.getSession();if(console.log("Datos de sesi\xF3n:",n,e),!n?.session){console.warn("\u26A0 No hay una sesi\xF3n activa.");return}let{error:o}=yield p.auth.signOut();if(o){console.error("\u26A0 Error al cerrar sesi\xF3n:",o.message);return}this.isLoggedIn=!1,this.router.navigate(["/login"]),this.cd.detectChanges()}catch(n){console.error("\u26A0 Error inesperado al cerrar sesi\xF3n:",n)}})}static \u0275fac=function(e){return new(e||t)(d(I),d(h))};static \u0275cmp=f({type:t,selectors:[["app-root"]],decls:5,vars:1,consts:[[1,"nav"],["routerLinkActive","selected","routerLink","home",1,"btn","btn-outline-primary"],["class","btn btn-outline-danger",3,"click",4,"ngIf"],[1,"btn","btn-outline-danger",3,"click"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"button",1),s(2,"Inicio"),r(),A(3,Y,2,0,"button",2),r(),U(4,"router-outlet")),e&2&&(u(3),g("ngIf",o.isLoggedIn))},dependencies:[P,D,S,R,j],styles:[".nav[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;margin-bottom:2rem;padding:1rem;display:flex;justify-content:center;align-items:center}h1[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}"]})};N(L,G).catch(t=>console.error(t));
