import{a as N,b as P,c as I,d as S,e as U,f as j}from"./chunk-CPBZMBZI.js";import{Ab as w,Bb as f,Ca as C,Ia as d,Ka as r,La as i,Ma as T,Pa as b,Qa as v,Ra as y,V as g,W as h,Wa as a,fb as H,gb as _,pa as p,ta as l,tb as x,vb as A,xa as u}from"./chunk-QWSCER6P.js";import{f as m}from"./chunk-PZ5UXJ7I.js";function z(t,n){t&1&&(r(0,"button",4),a(1,"Login"),i())}function G(t,n){t&1&&(r(0,"button",5),a(1,"Registro"),i())}function J(t,n){if(t&1){let e=b();r(0,"button",6),v("click",function(){g(e);let s=y();return h(s.irASeccionUsuarios())}),a(1,"Secci\xF3n Usuarios"),i()}}var L=w(f.apiUrl,f.publicAnonKey),D=class t{constructor(n,e){this.cd=n;this.router=e}isAdmin=!1;usuarioAutenticado=!1;cargandoBotones=!0;ngOnInit(){return m(this,null,function*(){yield this.verificarAdmin();let{data:n}=yield L.auth.getSession();this.usuarioAutenticado=!!n.session?.user,this.cargandoBotones=!1})}verificarAdmin(){return m(this,null,function*(){let{data:n}=yield L.auth.getSession();console.log("Sesi\xF3n:",n);let e=n.session?.user;if(!e){this.isAdmin=!1,this.cd.detectChanges();return}let{data:o,error:s}=yield L.from("administradores").select("id").eq("id",e.id).maybeSingle();console.log("AdminData:",o,"Error:",s),this.isAdmin=!!o,this.cd.detectChanges()})}irASeccionUsuarios(){this.isAdmin&&this.router.navigate(["/admin/usuarios"])}static \u0275fac=function(e){return new(e||t)(l(_),l(I))};static \u0275cmp=u({type:t,selectors:[["app-home"]],decls:8,vars:3,consts:[[1,"contenedor-botones"],["class","btn btn-outline-primary","routerLink","/login",4,"ngIf"],["class","btn btn-outline-primary","routerLink","/registro",4,"ngIf"],["class","btn btn-outline-primary",3,"click",4,"ngIf"],["routerLink","/login",1,"btn","btn-outline-primary"],["routerLink","/registro",1,"btn","btn-outline-primary"],[1,"btn","btn-outline-primary",3,"click"]],template:function(e,o){e&1&&(r(0,"title"),a(1,"Home"),i(),r(2,"h1"),a(3,"Bienvenidos a la Cl\xEDnica Online"),i(),r(4,"div",0),C(5,z,2,0,"button",1)(6,G,2,0,"button",2)(7,J,2,0,"button",3),i()),e&2&&(p(5),d("ngIf",!o.usuarioAutenticado),p(),d("ngIf",!o.usuarioAutenticado),p(),d("ngIf",o.isAdmin))},dependencies:[A,x,S],styles:["h1[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-weight:600;color:#0d6efd;text-align:center;margin-top:20px}body[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}.contenedor-botones[_ngcontent-%COMP%]{text-align:center}"]})};var R=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=u({type:t,selectors:[["app-error"]],decls:2,vars:0,template:function(e,o){e&1&&(r(0,"h1"),a(1,"404 p\xE1gina no encontrada"),i())},encapsulation:2})};var q=[{path:"",pathMatch:"full",redirectTo:"home"},{path:"home",component:D},{path:"login",loadComponent:()=>import("./chunk-M2FRV5CE.js").then(t=>t.LoginComponent)},{path:"registro",loadComponent:()=>import("./chunk-6YHLOBXN.js").then(t=>t.RegistroComponent)},{path:"admin/usuarios",loadComponent:()=>import("./chunk-GJ52ZZYD.js").then(t=>t.SeccionUsuariosComponent)},{path:"**",component:R}];var B={providers:[H({eventCoalescing:!0}),j(q)]};function Q(t,n){if(t&1){let e=b();r(0,"button",3),v("click",function(){g(e);let s=y();return h(s.logout())}),a(1,"Cerrar Sesi\xF3n"),i()}}var c=w(f.apiUrl,f.publicAnonKey),k=class t{constructor(n,e){this.cd=n;this.router=e}isLoggedIn=!1;errorMessage="";ngOnInit(){return m(this,null,function*(){yield this.checkSession(),c.auth.onAuthStateChange((n,e)=>m(this,null,function*(){e?.user?yield this.checkSession():(this.isLoggedIn=!1,this.cd.detectChanges())}))})}checkSession(){return m(this,null,function*(){let{data:n}=yield c.auth.getSession(),e=n.session?.user;if(!e){this.isLoggedIn=!1,this.cd.detectChanges();return}let o="",s,{data:M}=yield c.from("administradores").select("id").eq("id",e.id).maybeSingle();M&&(s=M,o="admin");let{data:O}=yield c.from("pacientes").select("id").eq("id",e.id).maybeSingle();O&&(s=O,o="paciente");let{data:E}=yield c.from("especialistas").select("id, aprobado").eq("id",e.id).maybeSingle();if(E&&(s=E,o="especialista",!E.aprobado)){console.warn("\u26A0 Este especialista a\xFAn no ha sido aprobado."),yield c.auth.signOut(),this.isLoggedIn=!1,this.router.navigate(["/login"]),this.cd.detectChanges();return}if(!s){console.warn("\u26A0 Usuario no encontrado en ninguna tabla."),yield c.auth.signOut(),this.isLoggedIn=!1,this.router.navigate(["/login"]),this.cd.detectChanges();return}this.isLoggedIn=!0,this.cd.detectChanges()})}logout(){return m(this,null,function*(){try{let{data:n}=yield c.auth.getSession();if(!n?.session){console.warn("\u26A0 No hay una sesi\xF3n activa.");return}let{error:e}=yield c.auth.signOut();if(e){console.error("\u26A0 Error al cerrar sesi\xF3n:",e.message);return}this.isLoggedIn=!1,this.router.navigate(["/login"]),this.cd.detectChanges()}catch(n){console.error("\u26A0 Error inesperado al cerrar sesi\xF3n:",n)}})}static \u0275fac=function(e){return new(e||t)(l(_),l(I))};static \u0275cmp=u({type:t,selectors:[["app-root"]],decls:5,vars:1,consts:[[1,"nav"],["routerLinkActive","selected","routerLink","home",1,"btn","btn-outline-primary"],["class","btn btn-outline-danger",3,"click",4,"ngIf"],[1,"btn","btn-outline-danger",3,"click"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"button",1),a(2,"Inicio"),i(),C(3,Q,2,0,"button",2),i(),T(4,"router-outlet")),e&2&&(p(3),d("ngIf",o.isLoggedIn))},dependencies:[P,A,x,S,U],styles:[".nav[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;margin-bottom:2rem;padding:1rem;display:flex;justify-content:center;align-items:center}h1[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}"]})};N(k,B).catch(t=>console.error(t));
