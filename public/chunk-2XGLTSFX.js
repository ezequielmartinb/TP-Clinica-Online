import{a as D}from"./chunk-AWOUOEWW.js";import{c as q}from"./chunk-CPBZMBZI.js";import{a as j,b as f,c as $,d as G,e as z,f as P,h as R,j as K,k as W,q as B}from"./chunk-DDJUIS55.js";import{Ab as N,Bb as M,Ca as d,Ia as s,Ka as a,La as l,Ma as p,Pa as L,Qa as g,Ra as u,Sa as w,V as h,W as y,Wa as c,Xa as k,Ya as I,na as C,pa as r,sb as U,ta as E,tb as F,vb as V,xa as O}from"./chunk-QWSCER6P.js";import{f as b}from"./chunk-PZ5UXJ7I.js";function J(t,n){t&1&&(a(0,"small"),c(1,"\u26A0 Debes ingresar un email."),l())}function Q(t,n){t&1&&(a(0,"small"),c(1,"\u26A0 El formato del email es incorrecto."),l())}function X(t,n){if(t&1&&(a(0,"div"),d(1,J,2,0,"small",4)(2,Q,2,0,"small",4),l()),t&2){let e,i,o=u();r(),s("ngIf",(e=o.formularioLogin.get("mail"))==null||e.errors==null?null:e.errors.required),r(),s("ngIf",(i=o.formularioLogin.get("mail"))==null||i.errors==null?null:i.errors.email)}}function Y(t,n){t&1&&(a(0,"small"),c(1,"\u26A0 Debes ingresar una contrase\xF1a."),l())}function Z(t,n){t&1&&(a(0,"small"),c(1,"\u26A0 La contrase\xF1a debe tener al menos 6 caracteres."),l())}function ee(t,n){if(t&1&&(a(0,"div"),d(1,Y,2,0,"small",4)(2,Z,2,0,"small",4),l()),t&2){let e,i,o=u();r(),s("ngIf",(e=o.formularioLogin.get("password"))==null||e.errors==null?null:e.errors.required),r(),s("ngIf",(i=o.formularioLogin.get("password"))==null||i.errors==null?null:i.errors.minlength)}}function ie(t,n){t&1&&(a(0,"div",9),p(1,"div",10),a(2,"p"),c(3,"Cargando..."),l()())}function te(t,n){if(t&1){let e=L();a(0,"div")(1,"button",12),g("click",function(){let o=h(e).$implicit,m=u(2);return y(m.quickAccess(o))}),p(2,"img",13),c(3),l()()}if(t&2){let e=n.$implicit,i=n.index;r(2),w("alt","Foto de ",e.nombre,""),s("src",e.imagen_perfil,C),r(),I(" Acceso r\xE1pido a paciente ",i+1," ")}}function ne(t,n){if(t&1){let e=L();a(0,"div")(1,"button",12),g("click",function(){let o=h(e).$implicit,m=u(2);return y(m.quickAccess(o))}),p(2,"img",13),c(3),l()()}if(t&2){let e=n.$implicit,i=n.index;r(2),w("alt","Foto de ",e.nombre,""),s("src",e.imagen_perfil,C),r(),I(" Acceso r\xE1pido a especialista ",i+1," ")}}function oe(t,n){if(t&1){let e=L();a(0,"div")(1,"button",14),g("click",function(){h(e);let o=u(2);return y(o.quickAccess(o.administrador))}),p(2,"img",13),c(3," Acceso r\xE1pido administrador "),l()()}if(t&2){let e=u(2);r(2),w("alt","Foto de ",e.administrador.nombre,""),s("src",e.administrador.imagen_perfil,C)}}function re(t,n){if(t&1&&(a(0,"div"),d(1,te,4,4,"div",11)(2,ne,4,4,"div",11)(3,oe,4,3,"div",4),l()),t&2){let e=u();r(),s("ngForOf",e.pacientes),r(),s("ngForOf",e.especialistas),r(),s("ngIf",e.administrador)}}function ae(t,n){t&1&&(a(0,"div",9),p(1,"div",10),a(2,"p"),c(3,"Iniciando sesion..."),l()())}var _=N(M.apiUrl,M.publicAnonKey),H=class t{constructor(n,e){this.router=n;this.authService=e}mail="";password="";errorMessage="";message="";messageType="";formularioLogin;isLoading=!1;pacientes=[];especialistas=[];administrador;isLoadingUsuarios=!1;ngOnInit(){this.formularioLogin=new z({mail:new P("",[f.required,f.email]),password:new P("",[f.required,f.minLength(6)])}),this.cargarUsuarios()}login(){return b(this,null,function*(){this.errorMessage="",this.isLoading=!0;try{let n=this.formularioLogin.get("mail")?.value,e=this.formularioLogin.get("password")?.value,{data:i,error:o}=yield _.auth.signInWithPassword({email:n,password:e});if(o||!i?.user){this.errorMessage="\u26A0 Email o contrase\xF1a incorrectos.";return}let m=i.user.id,se=i.user.email_confirmed_at,v,x="",{data:T}=yield _.from("administradores").select("id").eq("id",m).maybeSingle();T&&(v=T,x="administrador");let{data:A}=yield _.from("pacientes").select("id").eq("id",m).maybeSingle();A&&(v=A,x="paciente");let{data:S}=yield _.from("especialistas").select("id, aprobado").eq("id",m).maybeSingle();if(S&&(v=S,x="especialista",!S.aprobado)){this.errorMessage="\u26A0 Tu cuenta debe ser aprobada por un administrador.";return}if(!v){this.errorMessage="\u26A0 Usuario no encontrado.";return}this.router.navigate(["/home"]),this.authService.setUsuario(n),this.authService.setRol(x)}catch{this.errorMessage="\u26A0 Error al iniciar sesi\xF3n."}finally{this.isLoading=!1}})}obtenerUsuarios(n,e){return b(this,null,function*(){let{data:i,error:o}=yield _.from(n).select("*").limit(e);return o?(console.error(`Error obteniendo usuarios de ${n}:`,o),[]):i})}cargarUsuarios(){return b(this,null,function*(){this.isLoadingUsuarios=!0,this.pacientes=yield this.obtenerUsuarios("pacientes",3),this.especialistas=yield this.obtenerUsuarios("especialistas",2),this.administrador=(yield this.obtenerUsuarios("administradores",1))[0],console.log("Pacientes:",this.pacientes),console.log("Especialistas:",this.especialistas),console.log("Administrador:",this.administrador),this.isLoadingUsuarios=!1})}quickAccess(n){this.formularioLogin.patchValue({mail:n.mail,password:n.contrasena}),console.log(`Acceso r\xE1pido a: ${n.nombre} ${n.apellido}`)}static \u0275fac=function(e){return new(e||t)(E(q),E(D))};static \u0275cmp=O({type:t,selectors:[["app-login"]],decls:18,vars:8,consts:[[1,"contenedor-login"],[1,"formulario-login"],[3,"ngSubmit","formGroup"],["type","text","formControlName","mail","placeholder","Email"],[4,"ngIf"],["type","password","formControlName","password","placeholder","Password"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","overlay",4,"ngIf"],[1,"error-msg"],[1,"overlay"],[1,"spinner"],[4,"ngFor","ngForOf"],[1,"btn","btn-outline-primary","quick-btn",3,"click"],[1,"profile-img",3,"src","alt"],[1,"btn","btn-outline-primary",3,"click"]],template:function(e,i){if(e&1&&(a(0,"title"),c(1,"Login"),l(),a(2,"h1"),c(3,"Inicia sesi\xF3n"),l(),a(4,"div",0)(5,"div",1)(6,"form",2),g("ngSubmit",function(){return i.login()}),p(7,"input",3),d(8,X,3,2,"div",4),p(9,"input",5),d(10,ee,3,2,"div",4),a(11,"button",6),c(12,"Iniciar sesi\xF3n"),l(),d(13,ie,4,0,"div",7)(14,re,4,3,"div",4),l(),a(15,"div",8),c(16),l()()(),d(17,ae,4,0,"div",7)),e&2){let o,m;r(6),s("formGroup",i.formularioLogin),r(2),s("ngIf",((o=i.formularioLogin.get("mail"))==null?null:o.invalid)&&((o=i.formularioLogin.get("mail"))==null?null:o.touched)),r(2),s("ngIf",((m=i.formularioLogin.get("password"))==null?null:m.invalid)&&((m=i.formularioLogin.get("password"))==null?null:m.touched)),r(),s("disabled",i.formularioLogin.invalid||i.isLoading),r(2),s("ngIf",i.isLoadingUsuarios),r(),s("ngIf",!i.isLoadingUsuarios),r(2),k(i.errorMessage),r(),s("ngIf",i.isLoading)}},dependencies:[V,U,F,B,R,j,$,G,K,W],styles:["body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;font-family:Poppins,sans-serif;background-color:#f4f4f4}.contenedor-login[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.formulario-login[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0003;width:100%;max-width:400px}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin:10px 0;border:1px solid #ccc;border-radius:5px}.btn-outline-primary[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:10px;border-radius:5px}.btn-success[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:10px;border:none;border-radius:5px;cursor:pointer;background:#28a745;color:#fff}.btn-link[_ngcontent-%COMP%]{background:none;color:#007bff;cursor:pointer}.error-msg[_ngcontent-%COMP%]{color:red;margin-top:10px;display:flex;justify-content:center;text-align:center}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;justify-content:center;align-items:center;z-index:9999;pointer-events:none}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #28a745;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:10px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;font-size:18px;font-weight:700}.profile-img[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%;object-fit:cover}"]})};export{H as LoginComponent};
