import{a as z,b as u,c as k,d as J,e as Z,f as _,g as B,h as K,i as H,j as Q,k as W,l as X,m as Y,n as ee,o as te}from"./chunk-CV4BKI4J.js";import{$ as ie,A as n,B as l,C as c,D as A,E as M,F as L,G as S,H as d,I as s,J as q,R as G,S as U,V as $,Z as j,_ as N,j as O,k as D,p as o,r as F,s as V,w as p,y as a}from"./chunk-HDPR4ZAD.js";import{a as I,b as w,f as T}from"./chunk-PZ5UXJ7I.js";function ne(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function le(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Solo se permiten letras."),l())}function oe(e,r){if(e&1&&(n(0,"div"),p(1,ne,2,0,"small",6)(2,le,2,0,"small",6),l()),e&2){let t,i,m=d();o(),a("ngIf",(t=m.formularioRegistro.get("nombre"))==null||t.errors==null?null:t.errors.required),o(),a("ngIf",(i=m.formularioRegistro.get("nombre"))==null||i.errors==null?null:i.errors.pattern)}}function ae(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function se(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Solo se permiten letras."),l())}function me(e,r){if(e&1&&(n(0,"div"),p(1,ae,2,0,"small",6)(2,se,2,0,"small",6),l()),e&2){let t,i,m=d();o(),a("ngIf",(t=m.formularioRegistro.get("apellido"))==null||t.errors==null?null:t.errors.required),o(),a("ngIf",(i=m.formularioRegistro.get("apellido"))==null||i.errors==null?null:i.errors.pattern)}}function pe(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function ue(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Debe ser mayor de 18 a\xF1os."),l())}function de(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Debe ser menor de 99 a\xF1os."),l())}function ge(e,r){if(e&1&&(n(0,"div"),p(1,pe,2,0,"small",6)(2,ue,2,0,"small",6)(3,de,2,0,"small",6),l()),e&2){let t,i,m,g=d();o(),a("ngIf",(t=g.formularioRegistro.get("edad"))==null||t.errors==null?null:t.errors.required),o(),a("ngIf",(i=g.formularioRegistro.get("edad"))==null||i.errors==null?null:i.errors.min),o(),a("ngIf",(m=g.formularioRegistro.get("edad"))==null||m.errors==null?null:m.errors.max)}}function ce(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function _e(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Debe contener 6 o 7 numeros."),l())}function fe(e,r){if(e&1&&(n(0,"div"),p(1,ce,2,0,"small",6)(2,_e,2,0,"small",6),l()),e&2){let t,i,m=d();o(),a("ngIf",(t=m.formularioRegistro.get("dni"))==null||t.errors==null?null:t.errors.required),o(),a("ngIf",(i=m.formularioRegistro.get("dni"))==null||i.errors==null?null:i.errors.pattern)}}function ve(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function xe(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Ingrese un mail valido."),l())}function Re(e,r){if(e&1&&(n(0,"div"),p(1,ve,2,0,"small",6)(2,xe,2,0,"small",6),l()),e&2){let t,i,m=d();o(),a("ngIf",(t=m.formularioRegistro.get("mail"))==null||t.errors==null?null:t.errors.required),o(),a("ngIf",(i=m.formularioRegistro.get("mail"))==null||i.errors==null?null:i.errors.email)}}function be(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function he(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Debe ser mayor de 6 caracteres."),l())}function Ce(e,r){if(e&1&&(n(0,"div"),p(1,be,2,0,"small",6)(2,he,2,0,"small",6),l()),e&2){let t,i,m=d();o(),a("ngIf",(t=m.formularioRegistro.get("password"))==null||t.errors==null?null:t.errors.required),o(),a("ngIf",(i=m.formularioRegistro.get("password"))==null||i.errors==null?null:i.errors.minlength)}}function Ee(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function ye(e,r){if(e&1&&(n(0,"div"),p(1,Ee,2,0,"small",6),l()),e&2){let t,i=d();o(),a("ngIf",(t=i.formularioRegistro.get("tipo"))==null||t.errors==null?null:t.errors.required)}}function Se(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function Ie(e,r){if(e&1&&(n(0,"div"),p(1,Se,2,0,"small",6),l()),e&2){let t,i=d(2);o(),a("ngIf",(t=i.formularioRegistro.get("obra_social"))==null||t.errors==null?null:t.errors.required)}}function we(e,r){if(e&1&&(n(0,"div")(1,"label"),s(2,"Obra social:"),l(),n(3,"select",19)(4,"option",20),s(5,"OSDE"),l(),n(6,"option",21),s(7,"Accord Salud"),l(),n(8,"option",22),s(9,"Galeno"),l()(),p(10,Ie,2,1,"div",6),l()),e&2){let t,i=d();o(10),a("ngIf",(t=i.formularioRegistro.get("obra_social"))==null?null:t.invalid)}}function Te(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Este campo es obligatorio."),l())}function Fe(e,r){if(e&1&&(n(0,"div"),p(1,Te,2,0,"small",6),l()),e&2){let t,i=d(2);o(),a("ngIf",(t=i.formularioRegistro.get("especialidad"))==null||t.errors==null?null:t.errors.required)}}function Ae(e,r){if(e&1&&(n(0,"div")(1,"label"),s(2,"Especialidad:"),l(),n(3,"select",23)(4,"option",24),s(5,"Traumatologia"),l(),n(6,"option",25),s(7,"Cardiologia"),l(),n(8,"option",26),s(9,"Oncologia"),l()(),p(10,Fe,2,1,"div",6),l()),e&2){let t,i=d();o(10),a("ngIf",(t=i.formularioRegistro.get("especialidad"))==null?null:t.invalid)}}function Me(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Debes subir una imagen."),l())}function qe(e,r){if(e&1&&(n(0,"div"),p(1,Me,2,0,"small",6),l()),e&2){let t,i=d();o(),a("ngIf",(t=i.formularioRegistro.get("avatarFile"))==null||t.errors==null?null:t.errors.required)}}function Ne(e,r){e&1&&(n(0,"small"),s(1,"\u26A0 Debes subir una imagen."),l())}function Pe(e,r){if(e&1&&(n(0,"div"),p(1,Ne,2,0,"small",6),l()),e&2){let t,i=d(2);o(),a("ngIf",(t=i.formularioRegistro.get("avatarFile2"))==null||t.errors==null?null:t.errors.required)}}function Oe(e,r){if(e&1){let t=L();n(0,"div")(1,"input",15),S("change",function(m){O(t);let g=d();return D(g.onFileSelected(m,"avatarFile2"))}),l(),p(2,Pe,2,1,"div",6),l()}if(e&2){let t,i=d();o(2),a("ngIf",(t=i.formularioRegistro.get("avatarFile2"))==null?null:t.invalid)}}function De(e,r){e&1&&(A(0),s(1,"Registro"),M())}function Ve(e,r){e&1&&(A(0),c(1,"div",27),s(2," Registrando... "),M())}function Le(e,r){e&1&&(n(0,"div",28),c(1,"div",29),n(2,"p"),s(3,"Procesando..."),l()())}var v=j(N.apiUrl,N.publicAnonKey),re=class e{constructor(r,t){this.router=r;this.authService=t}formularioRegistro;avatarFile=null;avatarFile2=null;especialista;paciente;message="";messageType="success";errorMessage="";isLoading=!1;ngOnInit(){this.formularioRegistro=new Z({nombre:new _("",[u.required,u.pattern("^[a-zA-Z\xF1\xD1\xE1\xE9\xED\xF3\xFA\xC1\xC9\xCD\xD3\xDA ]+$")]),apellido:new _("",[u.required,u.pattern("^[a-zA-Z\xF1\xD1\xE1\xE9\xED\xF3\xFA\xC1\xC9\xCD\xD3\xDA ]+$")]),dni:new _("",[u.required,u.pattern(/^\d{7,8}$/)]),edad:new _("",[u.required,u.min(18),u.max(99)]),mail:new _("",[u.required,u.email]),password:new _("",[u.required,u.minLength(6)]),tipo:new _("",[u.required]),obra_social:new _(""),especialidad:new _("")}),this.formularioRegistro.get("tipo")?.valueChanges.subscribe(r=>{r==="paciente"?this.formularioRegistro.get("obra_social")?.setValidators([u.required]):(this.formularioRegistro.get("obra_social")?.clearValidators(),this.formularioRegistro.get("especialidad")?.setValidators([u.required])),this.formularioRegistro.get("obra_social")?.updateValueAndValidity(),this.formularioRegistro.get("especialidad")?.updateValueAndValidity()})}register(){return T(this,null,function*(){this.errorMessage="",this.message="",this.isLoading=!0;try{let r=["image/png","image/jpeg"];if(!this.avatarFile){this.errorMessage="\u26A0 Debes subir una imagen de perfil.";return}if(!r.includes(this.avatarFile.type)){this.errorMessage="\u26A0 La imagen de perfil debe ser PNG o JPEG.";return}if(this.formularioRegistro.get("tipo")?.value==="paciente"){if(!this.avatarFile2){this.errorMessage="\u26A0 Los pacientes deben subir una segunda imagen.";return}if(!r.includes(this.avatarFile2.type)){this.errorMessage="\u26A0 La segunda imagen debe ser PNG o JPEG.";return}}let t=this.formularioRegistro.get("mail")?.value,{data:i,error:m}=yield v.from("pacientes").select("id").eq("mail",t).single(),{data:g,error:f}=yield v.from("especialistas").select("id").eq("mail",t).single();if(i||g){this.errorMessage="\u26A0 Este email ya est\xE1 registrado.";return}let{data:b,error:h}=yield v.auth.signUp({email:t,password:this.formularioRegistro.get("password")?.value});if(h||!b?.user){this.errorMessage=this.getErrorMessage(h?.message||"Error");return}let x=b.user.id;console.log("mi avatar file es: ",this.avatarFile);let C=yield this.subirFoto(this.avatarFile,"avatars",x);console.log("mi imagen url es: ",C);let E,y={id:x,nombre:this.formularioRegistro.get("nombre")?.value,apellido:this.formularioRegistro.get("apellido")?.value,edad:this.formularioRegistro.get("edad")?.value,dni:this.formularioRegistro.get("dni")?.value,mail:this.formularioRegistro.get("mail")?.value,contrase\u00F1a:this.formularioRegistro.get("password")?.value,imagen_perfil:C};if(this.formularioRegistro.get("tipo")?.value==="paciente"&&this.avatarFile2!=null?(this.paciente=w(I({},y),{imagen_perfil_2:yield this.subirFoto(this.avatarFile2,"avatars",x),obra_social:this.formularioRegistro.get("obra_social")?.value}),console.log(this.paciente)):this.formularioRegistro.get("tipo")?.value==="especialista"&&(this.especialista=w(I({},y),{especialidad:this.formularioRegistro.get("especialidad")?.value}),console.log(this.especialista)),this.paciente!=null){let{error:R}=yield v.from("pacientes").insert([this.paciente]);E=R}if(this.especialista!=null){let{error:R}=yield v.from("especialistas").insert([this.especialista]);E=R}this.message="Registro exitoso. \xA1Bienvenido!",this.messageType="success"}catch{this.errorMessage="Ocurri\xF3 un error inesperado al registrar"}finally{this.isLoading=!1}})}onFileSelected(r,t){let i=r.target.files[0];i&&(this[t]=i,console.log(`Foto seleccionada (${t}):`,this[t]))}subirFoto(r,t,i){return T(this,null,function*(){let{data:m,error:g}=yield v.storage.from(t).upload(`${i}/${r.name}`,r,{upsert:!1});if(g)throw g;console.log("Archivo subido:",m);let{data:f}=v.storage.from(t).getPublicUrl(`${i}/${r.name}`);return console.log("URL p\xFAblica generada:",f),console.log(f.publicUrl),f.publicUrl})}getErrorMessage(r){return{"Password should be at least 6 characters.":"La contrase\xF1a debe tener al menos 6 caracteres","Signup requires a valid password":"Ingrese una contrase\xF1a v\xE1lida","Anonymous sign-ins are disabled":"Ingrese un usuario y contrase\xF1a v\xE1lidos","User already registered":"El usuario ya est\xE1 registrado"}[r]||`Error inesperado: ${r}`}static \u0275fac=function(t){return new(t||e)(F($),F(ie))};static \u0275cmp=V({type:e,selectors:[["app-register"]],decls:52,vars:18,consts:[["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],[1,"contenedor-registro"],[1,"formulario-registro"],[3,"ngSubmit","formGroup"],["type","text","placeholder","Nombre","formControlName","nombre",1,"register-input"],[4,"ngIf"],["type","text","placeholder","Apellido","formControlName","apellido",1,"register-input"],["type","number","placeholder","Edad","formControlName","edad",1,"register-input"],["type","number","placeholder","DNI","formControlName","dni",1,"register-input"],["type","email","placeholder","Email","formControlName","mail",1,"register-input"],["type","password","placeholder","Contrase\xF1a","formControlName","password",1,"register-input"],["formControlName","tipo",1,"register-input"],["value","paciente"],["value","especialista"],["type","file",1,"register-input",3,"change"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"error-msg"],["class","overlay",4,"ngIf"],["formControlName","obra_social",1,"register-input"],["value","osde"],["value","accord-salud"],["value","galeno"],["formControlName","especialidad",1,"register-input"],["value","traumatologia"],["value","cardiologia"],["value","oncologia"],[1,"spinner-btn"],[1,"overlay"],[1,"spinner"]],template:function(t,i){if(t&1&&(n(0,"head"),c(1,"meta",0)(2,"meta",1),n(3,"title"),s(4,"Registro"),l()(),n(5,"h1"),s(6,"Registrate"),l(),n(7,"div",2)(8,"div",3)(9,"form",4),S("ngSubmit",function(){return i.register()}),c(10,"input",5),p(11,oe,3,2,"div",6),c(12,"br")(13,"input",7),p(14,me,3,2,"div",6),c(15,"br")(16,"input",8),p(17,ge,4,3,"div",6),c(18,"br")(19,"input",9),p(20,fe,3,2,"div",6),c(21,"br")(22,"input",10),p(23,Re,3,2,"div",6),c(24,"br")(25,"input",11),p(26,Ce,3,2,"div",6),c(27,"br"),n(28,"label"),s(29,"Rol:"),l(),n(30,"select",12)(31,"option",13),s(32,"Paciente"),l(),n(33,"option",14),s(34,"Especialista"),l()(),p(35,ye,2,1,"div",6),c(36,"br"),p(37,we,11,1,"div",6)(38,Ae,11,1,"div",6),c(39,"br"),n(40,"input",15),S("change",function(g){return i.onFileSelected(g,"avatarFile")}),l(),p(41,qe,2,1,"div",6),c(42,"br"),p(43,Oe,3,1,"div",6),n(44,"button",16),p(45,De,2,0,"ng-container",6)(46,Ve,3,0,"ng-container",6),l()()()(),n(47,"div",17),s(48),l(),n(49,"div",17),s(50),l(),p(51,Le,4,0,"div",18)),t&2){let m,g,f,b,h,x,C,E,y,R,P;o(9),a("formGroup",i.formularioRegistro),o(2),a("ngIf",(m=i.formularioRegistro.get("nombre"))==null?null:m.invalid),o(3),a("ngIf",(g=i.formularioRegistro.get("apellido"))==null?null:g.invalid),o(3),a("ngIf",(f=i.formularioRegistro.get("edad"))==null?null:f.invalid),o(3),a("ngIf",(b=i.formularioRegistro.get("dni"))==null?null:b.invalid),o(3),a("ngIf",(h=i.formularioRegistro.get("mail"))==null?null:h.invalid),o(3),a("ngIf",(x=i.formularioRegistro.get("password"))==null?null:x.invalid),o(9),a("ngIf",(C=i.formularioRegistro.get("tipo"))==null?null:C.invalid),o(2),a("ngIf",((E=i.formularioRegistro.get("tipo"))==null?null:E.value)==="paciente"),o(),a("ngIf",((y=i.formularioRegistro.get("tipo"))==null?null:y.value)==="especialista"),o(3),a("ngIf",(R=i.formularioRegistro.get("avatarFile"))==null?null:R.invalid),o(2),a("ngIf",((P=i.formularioRegistro.get("tipo"))==null?null:P.value)==="paciente"),o(),a("disabled",i.formularioRegistro.invalid||i.isLoading),o(),a("ngIf",!i.isLoading),o(),a("ngIf",i.isLoading),o(2),q(i.errorMessage),o(2),q(i.message),o(),a("ngIf",i.isLoading)}},dependencies:[U,G,ee,B,X,Y,z,K,W,k,J,te,H,Q],styles:[".contenedor-registro[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.formulario-registro[_ngcontent-%COMP%]{background:#ffffffe6;padding:20px;border-radius:10px;box-shadow:0 4px 10px #0003;width:90%;max-width:400px;margin:auto;gap:20px;flex-direction:column}input[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc;background-color:#fffc;transition:.3s ease-in-out}input[_ngcontent-%COMP%]:focus{border-color:#3b82f6;box-shadow:0 0 8px #3b82f699}.error-msg[_ngcontent-%COMP%]{color:red;text-align:center;margin-top:15px;font-size:.9rem}small[_ngcontent-%COMP%]{color:red;font-size:.85rem}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;justify-content:center;align-items:center;z-index:9999;pointer-events:none}.spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #28a745;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{re as RegisterComponent};
