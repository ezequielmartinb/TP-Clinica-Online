import{c as J}from"./chunk-CPBZMBZI.js";import{a as X,c as Y,g as ee,l as te,m as ie,n as ne,p as oe}from"./chunk-DDJUIS55.js";import{$a as V,Aa as f,Ab as Q,Bb as L,Ca as _,Ia as p,Ka as r,La as a,Ma as T,Pa as U,Qa as b,Ra as d,Sa as H,V as v,W as x,Wa as s,Xa as u,Ya as k,Za as N,_a as B,bb as P,cb as A,db as Z,ea as S,na as $,pa as c,rb as z,sa as E,sb as W,ta as m,tb as K,vb as G,xa as q,za as w}from"./chunk-QWSCER6P.js";import{a as h,f as y}from"./chunk-PZ5UXJ7I.js";var M=class i{constructor(t,e){this.el=t;this.renderer=e}onMouseEnter(){this.renderer.setStyle(this.el.nativeElement,"transform","scale(1.5)"),this.renderer.setStyle(this.el.nativeElement,"transition","transform 0.3s")}onMouseLeave(){this.renderer.setStyle(this.el.nativeElement,"transform","scale(1)")}static \u0275fac=function(e){return new(e||i)(m(S),m(E))};static \u0275dir=w({type:i,selectors:[["","appDirectivaZoomFotos",""]],hostBindings:function(e,o){e&1&&b("mouseenter",function(){return o.onMouseEnter()})("mouseleave",function(){return o.onMouseLeave()})}})};var D=class i{constructor(t,e){this.el=t;this.renderer=e}rol;ngOnInit(){this.rol==="paciente"?this.renderer.setStyle(this.el.nativeElement,"background-color","#ADD8E6"):this.rol==="especialista"?this.renderer.setStyle(this.el.nativeElement,"background-color","#FFB6C1"):this.renderer.setStyle(this.el.nativeElement,"background-color","yellow")}static \u0275fac=function(e){return new(e||i)(m(S),m(E))};static \u0275dir=w({type:i,selectors:[["","appDirectivaColorRol",""]],inputs:{rol:[0,"appDirectivaColorRol","rol"]}})};var O=class i{transform(t){let e=t.toString().replace(/\D/g,""),o=e.length===8,n=o?e:e.padStart(7,"0");return o?n.replace(/(\d{2})(\d{3})(\d{3})/,"$1.$2.$3"):n.replace(/(\d{1})(\d{3})(\d{3})/,"$1.$2.$3")}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=f({name:"dni",type:i,pure:!0})};var I=class i{transform(t,e,o){return!t||!e||!o?t:t.filter(n=>n[o]?.toString().toLowerCase().includes(e.toLowerCase()))}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=f({name:"filtro",type:i,pure:!0})};var F=class i{transform(t){return t?t.slice().sort((e,o)=>{let n=e.apellido?.toLowerCase()||"",l=o.apellido?.toLowerCase()||"";return n.localeCompare(l)}):[]}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=f({name:"ordenar",type:i,pure:!0})};function ae(i,t){i&1&&(r(0,"div",3),T(1,"div",4),r(2,"p"),s(3,"Cargando datos..."),a()())}function se(i,t){if(i&1&&(r(0,"option",11),s(1),a()),i&2){let e=t.$implicit;p("value",e.clave),c(),k(" ",e.etiqueta," ")}}function ce(i,t){if(i&1){let e=U();r(0,"div",5)(1,"label",6),s(2,"Buscar por:"),a(),r(3,"select",7),V("ngModelChange",function(n){v(e);let l=d();return B(l.campoSeleccionado,n)||(l.campoSeleccionado=n),x(n)}),_(4,se,2,2,"option",8),a(),r(5,"input",9),V("ngModelChange",function(n){v(e);let l=d();return B(l.filtro,n)||(l.filtro=n),x(n)}),a(),r(6,"button",10),b("click",function(){v(e);let n=d();return x(n.irRegistro())}),s(7,"Registrar nuevo usuario"),a()()}if(i&2){let e=d();c(3),N("ngModel",e.campoSeleccionado),c(),p("ngForOf",e.camposDisponibles),c(),N("ngModel",e.filtro)}}function le(i,t){if(i&1&&T(0,"img",17),i&2){let e=d().$implicit;H("alt","Foto de ",e.nombre,""),p("src",e.imagen_perfil,$)}}function pe(i,t){if(i&1){let e=U();r(0,"tr",14)(1,"td"),s(2),a(),r(3,"td"),s(4),a(),r(5,"td"),s(6),a(),r(7,"td"),s(8),P(9,"dni"),a(),r(10,"td"),s(11),a(),r(12,"td")(13,"button",15),b("click",function(){let n=v(e).$implicit,l=d(2);return x(l.habilitarUsuario(n))}),s(14),a()(),r(15,"td"),_(16,le,1,3,"img",16),a()()}if(i&2){let e=t.$implicit,o=d(2);p("appDirectivaColorRol",o.obtenerTipoClase(e)),c(2),u(e.apellido),c(2),u(e.nombre),c(2),u(e.edad),c(2),u(A(9,9,e.dni)),c(3),u(e.mail),c(2),p("ngClass",e.aprobado?"btn-habilitado":"btn-deshabilitado"),c(),k(" ",e.aprobado?"Habilitado":"No habilitado"," "),c(2),p("ngIf",e.imagen_perfil)}}function de(i,t){if(i&1&&(r(0,"div",12)(1,"table")(2,"thead")(3,"tr")(4,"th"),s(5,"Apellido"),a(),r(6,"th"),s(7,"Nombre"),a(),r(8,"th"),s(9,"Edad"),a(),r(10,"th"),s(11,"DNI"),a(),r(12,"th"),s(13,"Email"),a(),r(14,"th"),s(15,"Aprobado"),a(),r(16,"th"),s(17,"Foto de perfil"),a()()(),r(18,"tbody"),_(19,pe,17,11,"tr",13),P(20,"filtro"),P(21,"ordenar"),a()()()),i&2){let e=d();c(19),p("ngForOf",A(21,5,Z(20,1,e.usuarios,e.filtro,e.campoSeleccionado)))}}var R=Q(L.apiUrl,L.publicAnonKey),re=class i{constructor(t){this.router=t}usuarios=[];cargando=!0;filtro="";campoSeleccionado="nombre";camposDisponibles=[{clave:"nombre",etiqueta:"Nombre"},{clave:"apellido",etiqueta:"Apellido"},{clave:"mail",etiqueta:"Mail"},{clave:"dni",etiqueta:"DNI"}];ngOnInit(){return y(this,null,function*(){this.usuarios=yield this.obtenerUsuarios(),this.cargando=!1})}obtenerUsuarios(){return y(this,null,function*(){let{data:t,error:e}=yield R.from("pacientes").select("*"),{data:o,error:n}=yield R.from("especialistas").select("*"),{data:l,error:j}=yield R.from("administradores").select("*");return e||n||j?(console.error("Error obteniendo datos:",e||n||j),[]):[...t.map(g=>h({},g)),...o.map(g=>h({},g)),...l.map(g=>h({},g))]})}obtenerTipoClase(t){return"obra_social"in t?"paciente":"especialidad"in t?"especialista":"es_admin"in t||t.rol==="admin"?"administrador":"Desconocido"}obtenerTablaPorTipo(t){return t.obra_social?"pacientes":t.especialidad?"especialistas":"administradores"}habilitarUsuario(t){return y(this,null,function*(){try{console.log(`\u2705 Cambiando estado de aprobaci\xF3n para ${t.mail}...`);let e=!t.aprobado,o=this.obtenerTablaPorTipo(t);console.log(o);let{error:n}=yield R.from(o).update({aprobado:e}).eq("id",t.id);if(n)throw n;console.log(`\u2705 Estado actualizado correctamente para ${t.mail}`),t.aprobado=e}catch(e){console.error("\u26A0 Error al actualizar estado de usuario:",e)}})}irRegistro(){this.router.navigate(["registro"])}static \u0275fac=function(e){return new(e||i)(m(J))};static \u0275cmp=q({type:i,selectors:[["app-seccion-usuarios"]],decls:7,vars:3,consts:[["class","spinner-container",4,"ngIf"],["class","d-flex gap-2 mb-3 align-items-center",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"d-flex","gap-2","mb-3","align-items-center"],["for","campo"],["id","campo",1,"form-select","w-auto",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Escrib\xED para filtrar...",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[3,"value"],[1,"table-responsive"],[3,"appDirectivaColorRol",4,"ngFor","ngForOf"],[3,"appDirectivaColorRol"],[3,"click","ngClass"],["appDirectivaZoomFotos","","class","img-perfil",3,"src","alt",4,"ngIf"],["appDirectivaZoomFotos","",1,"img-perfil",3,"src","alt"]],template:function(e,o){e&1&&(r(0,"title"),s(1,"Secci\xF3n usuarios"),a(),r(2,"h1"),s(3,"Listado de usuarios"),a(),_(4,ae,4,0,"div",0)(5,ce,8,3,"div",1)(6,de,22,7,"div",2)),e&2&&(c(4),p("ngIf",o.cargando),c(),p("ngIf",!o.cargando),c(),p("ngIf",!o.cargando))},dependencies:[oe,ie,ne,X,te,Y,ee,G,z,W,K,M,D,O,I,F],styles:[".table-responsive[_ngcontent-%COMP%]{overflow-x:auto;max-width:100%}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin:20px 0;font-size:16px;text-align:left;background:#fff;box-shadow:0 4px 8px #0000001a;border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #ddd}th[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;font-weight:700;text-transform:uppercase}tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}img[_ngcontent-%COMP%]{border-radius:50%;width:40px;height:40px;object-fit:cover}@media (max-width: 768px){th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px;padding:8px}}.btn-habilitado[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer}.btn-deshabilitado[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer}button[_ngcontent-%COMP%]:hover{opacity:.8}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px;text-align:center}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px;width:100%;text-align:center;position:relative;flex-direction:column}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(0,0,0,.1);border-left-color:#007bff;width:40px;height:40px;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:10px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}p[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin:0}.table-responsive[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;position:relative}"]})};export{re as SeccionUsuariosComponent};
